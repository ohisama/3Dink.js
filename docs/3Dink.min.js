(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?factory(exports,global):typeof define==='function'&&define.amd?define(['exports','global'],factory):(factory((global.Js3Dink=global.Js3Dink||{}),global))}(this,(function(exports,global){"use strict";const VERSION='1.1.7';console.log('3Dink.js Version',VERSION);if(THREE)
var webGlLib=THREE;function setWrapperLib(name){webGlLib=name}
let WIDTH;let HEIGHT;function setCanvasSize(arg_width,arg_height){WIDTH=arg_width;HEIGHT=arg_height}
function addURL(model,arg_url){if(!model.link)
model.link=new Link();Object.defineProperty(model.link,'url',{value:arg_url,enumerable:!0})}
function Link(){}
Link.prototype={isNewTab:'OFF',isShineOnMouse:'OFF',isShineOnTouch:'ON',shineColor:0x888888,emissiveObject:[],setNewTab:function(value,is_all=undefined){if(is_all==='ALL')
Link.prototype.isNewTab=value;else this.isNewTab=value},setShineColor:function(value,is_all=undefined){if(is_all==='ALL')
Link.prototype.shineColor=value;else this.emissiveObject=new webGlLib.Color(value)},setShineOnMouse:function(value,is_all=undefined){if(value!=='OFF'&&domEvent.isShineOnMouseCanvas==='OFF')
domEvent.isShineOnMouseCanvas=value;if(is_all==='ALL'){Link.prototype.isShineOnMouse=value;domEvent.isShineOnMouseCanvas=value}
else this.isShineOnMouse=value},setShineOnTouch:function(value,is_all=undefined){if(value!=='OFF'&&domEvent.isShineOnTouchCanvas==='OFF')
domEvent.isShineOnTouchCanvas=value;if(is_all==='ALL'){Link.prototype.isShineOnTouch=value;domEvent.isShineOnTouchCanvas=value}
else this.isShineOnTouch=value},}
const domEvent={renderer:undefined,moveCount:0,itsModel:undefined,selectedModel:{material:{emissive:{}}},rect:undefined,touchLen:0,isShineOnMouseCanvas:'OFF',isShineOnTouchCanvas:'ON',cursorDefault:'pointer',cursorOn3Dink:'auto',nonEmissiveObject:new webGlLib.Color(0),createEmissiveObject:function(){Link.prototype.emissiveObject=new webGlLib.Color(Link.prototype.shineColor)},getMousePoint:function(e){const mouse=new webGlLib.Vector2();mouse.x=e.clientX-this.rect.left;mouse.y=e.clientY-this.rect.top;mouse.x=(mouse.x/WIDTH)*2-1;mouse.y=-(mouse.y/HEIGHT)*2+1;return mouse},getTouchPoint:function(e){const touch=new webGlLib.Vector2();touch.x=e.touches[0].clientX-this.rect.left;touch.y=e.touches[0].clientY-this.rect.top;touch.x=(touch.x/WIDTH)*2-1;touch.y=-(touch.y/HEIGHT)*2+1;return touch},getIntersectObj:function(mouse,camera,scene){const ray=new webGlLib.Raycaster();ray.setFromCamera(mouse,camera);return ray.intersectObjects(scene.children,!0)},setParentObj:function(){if(!this.itsModel.link){this.itsModel=this.itsModel.parent;this.itsModel.isParent=!0}},setShineModel:function(itsModel){if(itsModel.isParent){for(let i in itsModel.children){itsModel.children[i].material.emissive=itsModel.link.emissiveObject}}
else itsModel.material.emissive=itsModel.link.emissiveObject},resetShineModel:function(selectedMatl){if(this.selectedModel.isParent){for(let i in this.selectedModel.children){this.selectedModel.children[i].material.emissive=this.nonEmissiveObject}}
else selectedMatl.emissive=this.nonEmissiveObject},addAnchorMouse:function(e,el,parent){if(el!==null)
parent.removeChild(el);const area=1;el=document.createElement('a');parent.appendChild(el,null);el.id='Anchor3Dink';el.setAttribute('href',this.itsModel.link.url);el.style.display='inline-block';el.style.top=e.clientY-this.rect.top-area/2+'px';el.style.left=e.clientX-this.rect.left-area/2+'px';el.style.width=area+'px';el.style.height=area+'px';el.style.position='absolute';parent.style.position='relative'},addAnchorTouch:function(e,el,parent){if(el!==null)
parent.removeChild(el);const area=1;el=document.createElement('a');parent.appendChild(el,null);el.id='Anchor3Dink';el.setAttribute('href',this.itsModel.link.url);el.style.display='inline-block';el.style.top=e.touches[0].clientY-this.rect.top-area/2+'px';el.style.left=e.touches[0].clientX-this.rect.left-area/2+'px';el.style.width=area+'px';el.style.height=area+'px';el.style.position='absolute';parent.style.position='relative'},shineModelFn:function(){let selectedMatl=this.selectedModel.material;const style=this.renderer.domElement.style;if(this.itsModel){if(this.itsModel.link||this.itsModel.parent.link){this.setParentObj();if(this.itsModel.link.isShineOnMouse!=='OFF'&&this.itsModel.link.url){if(!this.itsModel.material.emissive.r&&!this.itsModel.material.emissive.g&&!this.itsModel.material.emissive.b)
this.setShineModel(this.itsModel);style.cursor=this.cursorDefault}}
else style.cursor=this.cursorOn3Dink;if(this.selectedModel!==this.itsModel){this.resetShineModel(selectedMatl);this.selectedModel=this.itsModel}}
else if(style.cursor!==this.cursorOn3Dink){style.cursor=this.cursorOn3Dink;this.resetShineModel(selectedMatl)}},changeCursorFn:function(){const style=this.renderer.domElement.style;if(this.itsModel){if(this.itsModel.link||this.itsModel.parent.link){this.setParentObj();if(this.itsModel.link.url){style.cursor=this.cursorDefault}
else style.cursor=this.cursorOn3Dink}}
else if(style.cursor!==this.cursorOn3Dink){style.cursor=this.cursorOn3Dink}},shineModelFnTouch:function(){let selectedMatl=this.selectedModel.material;if(this.itsModel){if(this.itsModel.link||this.itsModel.parent.link){this.setParentObj();if(this.itsModel.link.isShineOnTouch!=='OFF'&&this.itsModel.link.url){if(!this.itsModel.material.emissive.r&&!this.itsModel.material.emissive.g&&!this.itsModel.material.emissive.b)
this.setShineModel(this.itsModel)}}
if(this.selectedModel!==this.itsModel){this.resetShineModel(selectedMatl);this.selectedModel=this.itsModel}}
else if(selectedMatl.emissive.r&&selectedMatl.emissive.g&&selectedMatl.emissive.b){this.resetShineModel(selectedMatl)}},shineModelA:function(e){let selectedMatl=this.selectedModel.material;const style=this.renderer.domElement.style;const el=global.document.getElementById('Anchor3Dink');const parent=this.renderer.domElement.parentNode;if(this.itsModel){if(this.itsModel.link||this.itsModel.parent.link){this.setParentObj();if(this.itsModel.link.isShineOnMouse!=='OFF'&&this.itsModel.link.url){if(!this.itsModel.material.emissive.r&&!this.itsModel.material.emissive.g&&!this.itsModel.material.emissive.b)
this.setShineModel(this.itsModel);style.cursor=this.cursorDefault;this.addAnchorMouse(e,el,parent)}
else{style.cursor=this.cursorOn3Dink;if(el!==null)
parent.removeChild(el)}
if(this.selectedModel!==this.itsModel){this.resetShineModel(selectedMatl);this.selectedModel=this.itsModel}}
else if(el!==null)
parent.removeChild(el)}
else　if(style.cursor!==this.cursorOn3Dink){style.cursor=this.cursorOn3Dink;this.resetShineModel(selectedMatl)}
else if(el!==null)
parent.removeChild(el)},changeCursorA:function(e){const style=this.renderer.domElement.style;const el=global.document.getElementById('Anchor3Dink');const parent=this.renderer.domElement.parentNode;if(this.itsModel){if(this.itsModel.link||this.itsModel.parent.link){this.setParentObj();if(this.itsModel.link.url){style.cursor=this.cursorDefault;this.addAnchorMouse(e,el,parent)}
else{style.cursor=this.cursorOn3Dink;if(el!==null)
parent.removeChild(el)}}}
else if(style.cursor!==this.cursorOn3Dink){style.cursor=this.cursorOn3Dink;if(el!==null)
parent.removeChild(el)}},shineModelATouch:function(e){let selectedMatl=this.selectedModel.material;const el=global.document.getElementById('Anchor3Dink');const parent=this.renderer.domElement.parentNode;if(this.itsModel){if(this.itsModel.link||this.itsModel.parent.link){this.setParentObj();if(this.itsModel.link.isShineOnTouch!=='OFF'&&this.itsModel.link.url){if(!this.itsModel.material.emissive.r&&!this.itsModel.material.emissive.g&&!this.itsModel.material.emissive.b)
this.setShineModel(this.itsModel);this.addAnchorTouch(e,el,parent)}
else{if(el!==null)
parent.removeChild(el)}
if(this.selectedModel!==this.itsModel){this.resetShineModel(selectedMatl);this.selectedModel=this.itsModel}}}
else if(selectedMatl.emissive.r&&selectedMatl.emissive.g&&selectedMatl.emissive.b){this.resetShineModel(selectedMatl);if(el!==null)
parent.removeChild(el)}},addAnchorItsObjA:function(e){const el=global.document.getElementById('Anchor3Dink');const parent=this.renderer.domElement.parentNode;if(this.itsModel){if(this.itsModel.link||this.itsModel.parent.link){this.setParentObj();if(this.itsModel.link.url){this.addAnchorTouch(e,el,parent)}
else{if(el!==null)
parent.removeChild(el)}}}
else if(el!==null)
parent.removeChild(el)},makeEventFnc:function(getPoint,process){return function(e){this.rect=this.renderer.domElement.getBoundingClientRect();const pointer=getPoint(e);const intersects=this.getIntersectObj(pointer,camera,scene);if(intersects[0])
this.itsModel=intersects[0].object;else this.itsModel=undefined;this.moveCount++;process(e)}},loadPageLink:function(e){if(this.moveCount<2){if(this.itsModel){if(!this.itsModel.link){if(this.itsModel.parent.link)
this.itsModel=this.itsModel.parent;else return}
if(this.itsModel.link.url){if(e.button===0||this.touchLen===1){if(this.itsModel.link.isNewTab==='ON')
global.open(this.itsModel.link.url);else location.href=this.itsModel.link.url}
else if(e.button===1)global.open(this.itsModel.link.url);else if(e.button===2)console.log(this.itsModel.link.url)}}}},addFnc:function(renderer,is_Hyperlink_mode='Fn',is_Hyperlink_mode_touch='Fn'){this.renderer=renderer;if(!WIDTH){WIDTH=renderer.domElement.style.width;WIDTH=WIDTH.substr(0,WIDTH.length-2)}
if(!HEIGHT){HEIGHT=renderer.domElement.style.height;HEIGHT=HEIGHT.substr(0,HEIGHT.length-2)}
let evfnc;this.createEmissiveObject();if(is_Hyperlink_mode==='Fn'){if(this.isShineOnMouseCanvas==='ON'){evfnc=this.makeEventFnc(this.getMousePoint.bind(this),this.shineModelFn.bind(this));renderer.domElement.addEventListener('mousemove',evfnc.bind(this),!1)}
else{evfnc=this.makeEventFnc(this.getMousePoint.bind(this),this.changeCursorFn.bind(this));renderer.domElement.addEventListener('mousemove',evfnc.bind(this),!1)}
renderer.domElement.addEventListener('mousedown',function(){this.moveCount=0}.bind(this),!1);renderer.domElement.addEventListener('mouseup',this.loadPageLink.bind(this),!1);console.log('Mouse: Fuction Mode by 3Dink.js')}
if(is_Hyperlink_mode_touch==='Fn'){if(this.isShineOnTouchCanvas==='ON'){evfnc=this.makeEventFnc(this.getTouchPoint.bind(this),this.shineModelFnTouch.bind(this));renderer.domElement.addEventListener('touchstart',evfnc.bind(this),!1);renderer.domElement.addEventListener('touchmove',evfnc.bind(this),!1)}
else{evfnc=this.makeEventFnc(this.getTouchPoint.bind(this),function(){});renderer.domElement.addEventListener('touchstart',evfnc.bind(this),!1);renderer.domElement.addEventListener('touchmove',evfnc.bind(this),!1)}
renderer.domElement.addEventListener('touchstart',function(e){this.moveCount=0;this.touchLen=e.touches.length}.bind(this),!1);renderer.domElement.addEventListener('touchend',this.loadPageLink.bind(this),!1);console.log('Touch: Fuction Mode by 3Dink.js')}
if(is_Hyperlink_mode==='A'){if(this.isShineOnMouseCanvas==='ON'){evfnc=this.makeEventFnc(this.getMousePoint.bind(this),this.shineModelFn.bind(this));renderer.domElement.addEventListener('mousemove',evfnc.bind(this),!1);evfnc=this.makeEventFnc(this.getMousePoint.bind(this),this.shineModelA.bind(this));renderer.domElement.addEventListener('mousedown',evfnc.bind(this),!1)}
else{evfnc=this.makeEventFnc(this.getMousePoint.bind(this),this.changeCursorFn.bind(this));renderer.domElement.addEventListener('mousemove',evfnc.bind(this),!1);evfnc=this.makeEventFnc(this.getMousePoint.bind(this),this.changeCursorA.bind(this));renderer.domElement.addEventListener('mousedown',evfnc.bind(this),!1)}
console.log('Mouse: Anchor Tag Mode by 3Dink.js')}
if(is_Hyperlink_mode_touch==='A'){if(this.isShineOnTouchCanvas==='ON'){evfnc=this.makeEventFnc(this.getTouchPoint.bind(this),this.shineModelATouch.bind(this));renderer.domElement.addEventListener('touchstart',evfnc.bind(this),!1);renderer.domElement.addEventListener('touchmove',evfnc.bind(this),!1);renderer.domElement.addEventListener('mouseup',function(){},!1)}
else{evfnc=this.makeEventFnc(this.getTouchPoint.bind(this),this.addAnchorItsObjA.bind(this));renderer.domElement.addEventListener('touchstart',evfnc.bind(this),!1);renderer.domElement.addEventListener('touchmove',evfnc.bind(this),!1);renderer.domElement.addEventListener('touchend',function(){},!1)}
console.log('Touch: Anchor Tag Mode by 3Dink.js')}},};function createBox(g_x,g_y,g_z,p_x,p_y,p_z,txr=undefined){const geometry=new webGlLib.BoxGeometry(g_x,g_y,g_z);if(txr!==undefined){const texture=new webGlLib.TextureLoader().load(txr);texture.minFilter=webGlLib.LinearFilter;var material=new webGlLib.MeshPhongMaterial({map:texture})}
const model=new webGlLib.Mesh(geometry,material);model.position.set(p_x,p_y,p_z);return model}
exports.setWrapperLib=setWrapperLib;exports.setCanvasSize=setCanvasSize;exports.addURL=addURL;exports.domEvent=domEvent;exports.createBox=createBox})))